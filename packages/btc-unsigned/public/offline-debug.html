<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BTC Creator - Offline Debug</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        color: #ffffff;
        min-height: 100vh;
        padding: 20px;
      }

      .debug-container {
        max-width: 800px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        padding: 30px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .debug-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .debug-title {
        font-size: 28px;
        font-weight: 600;
        color: #f7931a;
        margin-bottom: 10px;
      }

      .debug-subtitle {
        color: #cccccc;
        font-size: 16px;
      }

      .debug-section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .debug-section h3 {
        color: #f7931a;
        margin-bottom: 15px;
        font-size: 18px;
      }

      .debug-content {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        padding: 15px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        color: #00ff00;
        overflow-x: auto;
        white-space: pre-wrap;
        word-break: break-all;
      }

      .debug-button {
        background: #f7931a;
        color: #000;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        margin: 5px;
        transition: all 0.3s ease;
      }

      .debug-button:hover {
        background: #e6851a;
        transform: translateY(-1px);
      }

      .debug-button:active {
        transform: translateY(0);
      }

      .status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-online {
        background: #44ff44;
      }

      .status-offline {
        background: #ff4444;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      .button-group {
        text-align: center;
        margin: 20px 0;
      }

      @media (max-width: 600px) {
        .debug-container {
          padding: 20px;
          margin: 10px;
        }

        .debug-title {
          font-size: 24px;
        }

        .debug-content {
          font-size: 12px;
          padding: 10px;
        }
      }

      /* iOS PWA Safe Area Support */
      @supports (padding: max(0px)) {
        body {
          padding-left: max(20px, env(safe-area-inset-left));
          padding-right: max(20px, env(safe-area-inset-right));
          padding-top: max(20px, env(safe-area-inset-top));
          padding-bottom: max(20px, env(safe-area-inset-bottom));
        }
      }
    </style>
  </head>
  <body>
    <div class="debug-container">
      <div class="debug-header">
        <h1 class="debug-title">BTC Creator - Offline Debug</h1>
        <p class="debug-subtitle">Debug information and cache status</p>
      </div>

      <div class="debug-section">
        <h3>Connection Status</h3>
        <div class="debug-content" id="connectionStatus">
          Checking connection status...
        </div>
      </div>

      <div class="debug-section">
        <h3>Service Worker Status</h3>
        <div class="debug-content" id="swStatus">
          Checking service worker...
        </div>
      </div>

      <div class="debug-section">
        <h3>Cache Information</h3>
        <div class="debug-content" id="cacheInfo">
          Loading cache information...
        </div>
      </div>

      <div class="debug-section">
        <h3>Device Information</h3>
        <div class="debug-content" id="deviceInfo">Detecting device...</div>
      </div>

      <div class="button-group">
        <button class="debug-button" onclick="refreshAll()">Refresh All</button>
        <button class="debug-button" onclick="checkConnection()">
          Check Connection
        </button>
        <button class="debug-button" onclick="checkServiceWorker()">
          Check SW
        </button>
        <button class="debug-button" onclick="checkCache()">Check Cache</button>
        <button class="debug-button" onclick="clearCache()">Clear Cache</button>
        <button class="debug-button" onclick="goHome()">Go Home</button>
      </div>
    </div>

    <script>
      // Connection status checking
      function checkConnection() {
        const statusElement = document.getElementById('connectionStatus');
        const isOnline = navigator.onLine;

        let status = `Network Status: ${isOnline ? 'ONLINE' : 'OFFLINE'}\n`;
        status += `Navigator.onLine: ${navigator.onLine}\n`;
        status += `Last Check: ${new Date().toLocaleString()}\n`;

        if (isOnline) {
          // Test actual connectivity
          fetch('/manifest.json', { method: 'HEAD', cache: 'no-cache' })
            .then((response) => {
              status += `HTTP Test: SUCCESS (${response.status})\n`;
              statusElement.textContent = status;
            })
            .catch((error) => {
              status += `HTTP Test: FAILED (${error.message})\n`;
              statusElement.textContent = status;
            });
        } else {
          statusElement.textContent = status;
        }
      }

      // Service Worker status checking
      function checkServiceWorker() {
        const statusElement = document.getElementById('swStatus');
        let status = 'Service Worker Status:\n';

        if ('serviceWorker' in navigator) {
          status += '✓ Service Worker API supported\n';

          navigator.serviceWorker
            .getRegistrations()
            .then((registrations) => {
              if (registrations.length > 0) {
                status += `✓ ${registrations.length} registration(s) found\n`;
                registrations.forEach((reg, index) => {
                  status += `  Registration ${index + 1}:\n`;
                  status += `    Scope: ${reg.scope}\n`;
                  status += `    Active: ${reg.active ? 'Yes' : 'No'}\n`;
                  status += `    Waiting: ${reg.waiting ? 'Yes' : 'No'}\n`;
                  status += `    Installing: ${
                    reg.installing ? 'Yes' : 'No'
                  }\n`;
                });
              } else {
                status += '✗ No registrations found\n';
              }
              statusElement.textContent = status;
            })
            .catch((error) => {
              status += `✗ Error getting registrations: ${error.message}\n`;
              statusElement.textContent = status;
            });
        } else {
          status += '✗ Service Worker API not supported\n';
          statusElement.textContent = status;
        }
      }

      // Cache information checking
      async function checkCache() {
        const statusElement = document.getElementById('cacheInfo');
        let status = 'Cache Information:\n';

        if ('caches' in window) {
          try {
            const cacheNames = await caches.keys();
            status += `✓ Cache API supported\n`;
            status += `Total caches: ${cacheNames.length}\n`;

            if (cacheNames.length > 0) {
              status += '\nCache Details:\n';
              for (const cacheName of cacheNames) {
                const cache = await caches.open(cacheName);
                const keys = await cache.keys();
                status += `  ${cacheName}: ${keys.length} items\n`;

                // Show some sample URLs
                const sampleKeys = keys.slice(0, 3);
                sampleKeys.forEach((key) => {
                  status += `    - ${key.url}\n`;
                });
                if (keys.length > 3) {
                  status += `    ... and ${keys.length - 3} more\n`;
                }
              }
            }
          } catch (error) {
            status += `✗ Error checking cache: ${error.message}\n`;
          }
        } else {
          status += '✗ Cache API not supported\n';
        }

        statusElement.textContent = status;
      }

      // Device information
      function detectDevice() {
        const statusElement = document.getElementById('deviceInfo');
        const userAgent = navigator.userAgent;

        let status = 'Device Information:\n';
        status += `User Agent: ${userAgent}\n`;
        status += `Platform: ${navigator.platform}\n`;
        status += `Language: ${navigator.language}\n`;
        status += `Cookie Enabled: ${navigator.cookieEnabled}\n`;
        status += `Online: ${navigator.onLine}\n`;

        // Detect iOS/Android
        const isIOS = /iPad|iPhone|iPod/.test(userAgent);
        const isAndroid = /Android/.test(userAgent);
        status += `Device Type: ${
          isIOS ? 'iOS' : isAndroid ? 'Android' : 'Other'
        }\n`;

        // PWA detection
        const isPWA = window.matchMedia('(display-mode: standalone)').matches;
        status += `PWA Mode: ${isPWA ? 'Yes' : 'No'}\n`;

        // Screen information
        status += `Screen: ${screen.width}x${screen.height}\n`;
        status += `Viewport: ${window.innerWidth}x${window.innerHeight}\n`;
        status += `Pixel Ratio: ${window.devicePixelRatio}\n`;

        statusElement.textContent = status;
      }

      // Clear cache
      async function clearCache() {
        if ('caches' in window) {
          try {
            const cacheNames = await caches.keys();
            for (const cacheName of cacheNames) {
              await caches.delete(cacheName);
            }
            document.getElementById('cacheInfo').textContent =
              'Cache cleared successfully!';
            setTimeout(checkCache, 1000);
          } catch (error) {
            document.getElementById(
              'cacheInfo'
            ).textContent = `Failed to clear cache: ${error.message}`;
          }
        }
      }

      // Refresh all information
      function refreshAll() {
        checkConnection();
        checkServiceWorker();
        checkCache();
        detectDevice();
      }

      // Go home
      function goHome() {
        window.location.href = '/';
      }

      // Initialize on page load
      document.addEventListener('DOMContentLoaded', function () {
        refreshAll();

        // Auto-refresh every 30 seconds
        setInterval(refreshAll, 30000);
      });

      // Monitor online/offline events
      window.addEventListener('online', () => {
        checkConnection();
      });

      window.addEventListener('offline', () => {
        checkConnection();
      });

      // Service Worker message handling
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.addEventListener('message', (event) => {
          if (event.data && event.data.type === 'SW_READY') {
            console.log('Service Worker ready message received');
            checkServiceWorker();
          }
        });
      }
    </script>
  </body>
</html>
